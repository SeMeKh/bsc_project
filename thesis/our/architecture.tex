\قسمت{معماری \واژه{فریم.ورک}}
\برچسب{sec:arch}
در بخش \رجوع{gwt} با نحوه‌ی بیان یک \واژه{سناریو} آشنا شدیم. یک سناریو، در واقع پاسخ صحیح یک زیرمسأله از مسأله‌ی اصلی را بیان می‌کند.

\واژه{فریم.ورک} پیشنهادی ما، حول ایده‌ی \واژه{decoupling} \واژه{سناریو}‌ها از مصادیق صحت‌سنجی آن شکل گرفته است. در این معماری، \واژه{سناریو}‌هایی توسط برنامه‌نویس تعبیه می‌شود که مطابق تعریف، انتظار می‌رود همواره برقرار باشند. مجموعه‌ی این \واژه{سناریو}‌ها را به عنوان یک لایه از معماری \واژه{فریم.ورک} \واژه{تست} خود در نظر می‌گیریم و آن را «لایه‌ی \واژه{سناریو}» می‌نامیم. در این لایه، نویسنده‌ی \واژه{تست} تنها به توصیف نیازمندی‌های صحت‌سنجی برنامه می‌پردازد و دغدغه‌ی تولید مصادیق \واژه{سناریو}‌ها را نخواهد داشت.

با توجه به تعریف، خود \واژه{سناریو}‌ها تنها مجموعه‌ای از گزاره‌ها هستند که در یک پیاده‌سازی درست، برقرار خواهند بود. حال آن که سنجش صحت این گزاره‌ها می‌تواند \واژه{متریک} خوبی برای کیفیت کد باشد. در \واژه{فریم.ورک} پیشنهادی، لایه‌ی دیگری از معماری \واژه{تست} به این موضوع تخصیص دارد که آن را «لایه‌ی \واژه{اکتور}» می‌نامیم. در واقع، لایه‌ی \واژه{اکتور} موظف است تا با تغییر مداوم وضعیت سامانه، \واژه{پری.کاندیشن}‌های \واژه{سناریو}‌های مختلف را فراهم کند تا صحت آن‌ها سنجیده شود.

\شروع{شکل}[tbp]
\تنظیم‌ازوسط
\درج‌تصویر[پهنا=0.9\پهنای‌سطر]{architecture}
\تر\موقتم{
  مقایسه معماری پیشنهادی با معماری متداول آزمون
}
\شرح[\موقتم]{\موقتم~}
\برچسب{fig:architecture}
\پایان{شکل}

همانطور که در شکل \رجوع{fig:architecture} نشان داده شده، دو لایه‌ی
\واژه{سناریو} و \واژه{اکتور}، ارکان اصلی معماری پیشنهادی (معماری سمت
راست در شکل) جهت پیاده‌سازی \واژه{فریم.ورک} \واژه{تست} هستند. این دو
لایه، جایگیزین لایه‌ی «\واژه{تست}» در معماری رایج (معماری سمت چپ در
شکل) می‌شوند. لایه‌ی \نام{کاربرد}{Application}، در هر دو معماری مشترک
است و متن برنامه‌ی اصلی در این لایه نوشته می‌شود.

در معماری رایج، لایه‌ی \واژه{تست} عملیات زیر را انجام می‌دهد:

\شروع{بارهها}

\باره{\متن‌سیاه{\نام{آماده‌سازی}{Setup}:} همانطور که در بخش
  \رجوع{sec:testcase} اشاره شد، برای بررسی عملکرد \واژه{sut} در هر
  \واژه{تست.کیس} لازم است ورودی‌ها و پیش‌شرایط آن مهیا شده باشند. مثلاً
  برای بررسی عملکرد قسمت «ثبت‌نام» از یک سامانه‌ی آموزشی، لازم است یک
  دانشجو و یک ارائه از درس در سامانه موجود باشند تا بتوان صحت عملکرد
  ثبت‌نام را بر روی آن سنجید. }

\باره{ \متن‌سیاه{\نام{تحریک \واژه{اکشن} در سامانه}{Action Trigger}:} پس
  از آماده‌سازی حالت سامانه، دستوری که باعث اعمال رفتار مورد نظر توسط
  \واژه{sut} می‌شود را فراخوانی می‌نماییم. برای مثال، برای بررسی عملکرد
  ثبت‌نام در سامانه‌ی آموزش، تابعی که مربوط به عمل ثبت‌نام است را
  فراخوانی می‌نماییم. }

\باره{ \متن‌سیاه{\نام{اثبات صحت عملکرد}{Assertion}:} پس از تحریک
  \واژه{اکشن} در سامانه، باید حالت نهایی سامانه را بررسی نماییم و
  برقراری \واژه{پست.کاندیشن}‌هایی که توسط مشتری برای این عمل تعریف شده
  را در سامانه بررسی نماییم. در سامانه‌ی آموزش، باید مواردی مانند کم
  شدن ظرفیت ارائه‌ی درس پس از ثبت‌نام و قرار گرفتن دانشجو در لیست
  دانشجویان ارائه‌ی درس را بررسی نماییم. }

\باره{ \متن‌سیاه{\نام{خنثی‌سازی تغییرات}{Tear Down}:} پس از اطمینان از
  بررسی صحت عملکرد \واژه{sut}، تغییراتی که در قسمت‌های آماده‌سازی و
  تحریک، در حالت سامانه ایجاد شده را خنثی‌سازی می‌نماییم تا در عملیات
  سایر \واژه{تست}‌ها تداخل ایجاد نشود. }

\پایان{بارهها}

برای مثال، هنگام نوشتن \واژه{اکسپتنس.تست} برای سناریوی «\واژه{given}
یک دانشجو و یک ارائه‌ی درس موجود باشند؛ \واژه{when} دانشجو در ارائه
ثبت‌نام می‌کند؛ \واژه{then} باید ظرفیت ارائه یک واحد کم شده باشد»:

\شروع{بارهها}

\باره{ قسمت آماده‌سازی، باید موجودیت‌های مربوط به نیم‌سال تحصیلی، درس،
  استاد، ارائه‌ی درس توسط استاد و دانشجو را در سامانه ایجاد نماید. }

\باره{ قسمت تحریک \واژه{اکشن}، باید تابع مربوط به ثبت‌نام دانشجو در
  ارائه‌ی درس را فراخوانی نماید.}

\باره{ قسمت اثبات صحت عملکرد، باید ظرفیت ارائه را قبل و بعد از فراخوانی
  تابع ثبت‌نام، مقایسه نماید. }

\باره{ قسمت خنثی‌سازی تغییرات، باید موجودیت‌هایی که در قسمت‌های آماده‌سازی
  و تحریک \واژه{اکشن} در سامانه ایجاد شدند را حذف نماید}

\پایان{بارهها}

اما در معماری سه‌لایه‌ی پیشنهادی، بر خلاف معماری رایج، هنگام تبدیل
\واژه{اکسپتنس.کریتریا} (\واژه{پلین.تکست}) به
\واژه{اکسپتنس.تست}(\واژه{تست} اجراپذیر)، به جای اعمال شرایط ذکر شده در
قسمت «\واژه{given}» سناریو بر روی سامانه، آن شرایط را صرفا توصیف
می‌نماییم؛ همچنین به جای تحریک کنش مشخص شده در قسمت «\واژه{when}»
سناریو، رخداد آن کنش در سامانه را توصیف می‌نماییم. بدین ترتیب،
\واژه{اکسپتنس.تست}‌های به‌دست آمده، کاملاً توصیفی بوده و نه‌تنها تغییری در
وضعیت سامانه بوجود نمی‌آورند، بلکه به‌تنهایی قابل اجرا نیز نمی‌باشد. این
\واژه{اکسپتنس.تست}‌ها در لایه‌ی \واژه{سناریو} نوشته می‌شوند و قسمت
«\نام{توصیف سناریو}{Scenario Specification}» را تشکیل می‌دهند.

از طرفی، تمام عملیاتی که در قسمت‌های آماده‌سازی، تحریک \واژه{اکشن} و
خنثی‌سازی تغییرات از معماری رایج انجام می‌شدند، به لایه‌ی \واژه{اکتور}
منتقل می‌شوند. همانطور که در شکل \رجوع{fig:architecture} با علامت آدمک
مشخص شده، این قسمت‌‌ها همگی با سامانه در تعامل هستند و در حالت سامانه
تغییر ایجاد می‌کنند.

لایه‌ی \واژه{اکتور}، مستقل از اینکه چه \واژه{سناریو}‌هایی در سامانه وجود
دارد، با سامانه تعامل نموده و \واژه{اکشن}‌های مختلف را بر روی آن اعمال
می‌کند. ممکن است این تعامل توسط کاربر با استفاده از \واژه{یو.آی.} در
\واژه{پروداکشن} صورت پذیرد یا اینکه با فراخوانی توابع داخلی سامانه
توسط برنامه‌نویس وضعیت سامانه تغییر یابد.

قسمت «\نام{تشخیص سناریو}{Scenario Detection}» از لایه‌ی \واژه{سناریو}،
موظف است \واژه{اکشن}‌هایی که توسط لایه‌ی \واژه{اکتور} بر روی سامانه صورت
می‌پذیرد را وارسی نموده و با توجه به اینکه توصیف بخش‌های «\واژه{given}»،
«\واژه{when}» و «\واژه{then}» هر سناریو موجود است، حالت فعلی سامانه را
با توصیف «\واژه{given}» مطابقت داده و اگر \واژه{اکشن}ی که در حال رخداد
است، با «\واژه{when}» مطابق بود، پس از اجرای \واژه{اکشن}، قسمت
«\نام{اثبات سناریو}{Scenario Assertion}» را جهت بررسی برقراری
«\واژه{then}» و ثبت نتیجه و تولید گزارش فعال می‌سازد.

